<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Gestion des Pr√©sences ‚Äì Version Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f6fa;
        margin: 0;
        padding: 0;
    }
    #tabs {
        display: flex;
        background: #fff;
        box-shadow: 0 2px 5px #ccc;
    }
    #tabs button {
        flex: 1;
        padding: 15px;
        font-size: 16px;
        border: none;
        background: #eee;
        cursor: pointer;
        font-weight: bold;
    }
    #tabs button.active {
        background: #3498db;
        color: #fff;
    }
    .page {
        display: none;
        padding: 15px;
    }
    .activePage {
        display: block;
    }
    h2 {
        text-align: center;
        margin-bottom: 15px;
    }
    #panel {
        background: white;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 0 5px #ccc;
        margin-bottom: 20px;
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
    }
    input, select {
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-top: 5px;
        box-sizing: border-box;
    }
    button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
    }
    .btn-green { background: #4CAF50; color: white; }
    .btn-blue { background: #3498db; color: white; }
    .btn-red { background: #e74c3c; color: white; }
    .btn-gray { background: #555; color: white; }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0 5px #ccc;
    }
    th, td {
        padding: 12px;
        border-bottom: 1px solid #eee;
        text-align: center;
    }
    th {
        background: #f0f0f0;
        font-size: 15px;
    }
</style>
</head>
<body>

<div id="tabs">
    <button class="active" onclick="showPage(1)">Gestion</button>
    <button onclick="showPage(2)">R√©sum√©</button>
</div>

<div id="page1" class="page activePage">
<h2>Gestion des Pr√©sences - Mobile</h2>

<div id="panel">
    <label>Mati√®re :</label>
    <select id="matiere">
        <option>Maths</option>
        <option>Fran√ßais</option>
        <option>Histoire</option>
        <option>SVT</option>
        <option>Anglais</option>
        <option>Physique</option>
    </select>

    <label>Date :</label>
    <input type="date" id="dateSel">

    <label>Heure d√©but :</label>
    <input type="time" id="heureDebut">

    <label>Heure fin :</label>
    <input type="time" id="heureFin">

    <button class="btn-blue" onclick="loadAttendance()">Charger</button>
    <button class="btn-green" onclick="markAll()">Tout cocher (absents)</button>
</div>

<table id="studentsTable"></table>
<div id="saved">‚úî Sauvegard√©</div>
</div>

<div id="page2" class="page">
<h2>R√©sum√© des Absences</h2>
<div id="resume"></div>
</div>

<script>
/* -------------------------
   Solution 2 : vider ancien stockage
--------------------------*/
localStorage.removeItem("classData_mobile");

/* -------------------------
   ONGLES
--------------------------*/
function showPage(n) {
    document.querySelectorAll("#tabs button").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".page").forEach(p => p.classList.remove("activePage"));

    document.querySelectorAll("#tabs button")[n-1].classList.add("active");
    document.getElementById("page" + n).classList.add("activePage");

    if (n === 2) afficherResume();
}

/* -------------------------
   DONN√âES (cl√© version 2)
--------------------------*/
let classe = {
    students: [
        
        "AGBANDAN DJO JEAN MARIE VIANNEY",
        "ATTA Ekra Felix Boabre Karim",
        "BAMBA Nakyata",
        "BILEY Ehoule Joseph",
        "BLA Koffi Christ David Nolan Mals",
        "CISSE Begnon Rokia",
        "COULIBALY Bamory",
        "COLLIBALY Kafandja Fatoumats",
        "COULIBALY Yele Korotoum",
        "DIAKITE Alassane",
        "DIAKITE Yassine Ben-Salla",
        "DIALLO Abiba",
        "DIARRA Abdoulaye",
        "DIOMANDE Assata Roseline",
        "DIANI Thiomoo-Kindeinin Saida",
        "DOUMBIA Awa Noura",
        "EBROTIE Kesse Jean Fernand",
        "EHUI Yano- Ephraim",
        "ETTIEN Ekissi Aymeric Canisius",
        "FOFANA Makouny MAN KOLUNY",
        "FOFANA Maman",
        "FOPANA Zoumana",
        "GOMONT Nogbou Abigael Jean-Josu√©",
        "GUEIDIE Zrampica Franck Samuel",
        "KAMAGATE Yacouba",
        "KAMATE Aboubacar",
        "KEITA Noura Munier Jeanne Stephanie",
        "KINDO Tahirou",
        "KOFFI Amenan Maric Aude",
        "KOFFI Ngouan Jonathan Johka",
        "KONATE Djakaridja Aziz",
        "KONE Aminata",
        "KONE Dognon Zakariah",
        "KONE Moctar",
        "KONE Yassoungo Maimouna",
        "KOUADIO Elohim Excel Wilfried",
        "KOUADIO Koffi Modeste",
        "KOUADIO Ndri Salomon",
        "KOUASSI Jean-Marc Wilfried",
        "KOUKOUGNON Pepin Koudou Didier",
        "KRA Aya Auriane",
        "NANA Fatoumata",
        "NANGO Tanoh Karim Bienvenu",
        "N'GUESSAN Grahon Martine",
        "OKOU Yao Patrick Wilfried",
        "ONYEKWERE Favour Blesing Grace",
        "QUATTARA Ibrahima Ahmed",
        "QUATTARA Maimouna",
        "QUATTARA N'Lodja Kindinnin",
        "OUEDRAOGO Zakaria",
        "OYENIRAN Fatia Aziza Salimatou",
        "SERY Ibrahim",
        "SILUE Kolotcholoma",
        "SYLLA Fatoumata Zahra",
        "SYLLA Gaoussou Abdel Aziz",
        "THIENTA Aboudramane",
        "TOURE Mbegnan Hermane",
        "TOURE Zenab Fatim",
        "TRAH Djo Eden Diplexe",
        "YEBOUE Affou√©e Esther",
        "ZAN Bi Zan Ange Antonin"
    ],
    absences: {}
};

let saved = localStorage.getItem("classData_mobile_v2");
if (saved) classe = JSON.parse(saved);

function save() {
    localStorage.setItem("classData_mobile_v2", JSON.stringify(classe));
    let s = document.getElementById("saved");
    s.style.display = "block";
    setTimeout(() => s.style.display = "none", 1500);
}

/* -------------------------
   CHARGEMENT CR√âNEAU
--------------------------*/
function loadAttendance() {
    let date = dateSel.value;
    let h1 = heureDebut.value;
    let h2 = heureFin.value;
    let mat = matiere.value;

    if (!date || !h1 || !h2) return alert("Tu dois choisir date + heures.");

    let key = `${date}_${h1}-${h2}_${mat}`;
    if (!classe.absences[key]) classe.absences[key] = [];

    renderTable(key);
}

/* -------------------------
   AFFICHAGE TABLEAU
--------------------------*/
function renderTable(key) {
    let table = document.getElementById("studentsTable");
    let abs = classe.absences[key];

    let html = `
        <tr>
            <th>√âl√®ve</th>
            <th>Absent</th>
            <th>Supprimer</th>
        </tr>
    `;

    classe.students.forEach((name, i) => {
        let checked = abs.includes(i+1) ? "checked" : "";
        html += `
            <tr>
                <td>${name}</td>
                <td><input type="checkbox" ${checked} onclick="toggleAbsence('${key}', ${i+1})"></td>
                <td><button class="btn-red" onclick="deleteStudent(${i})">Supprimer</button></td>
            </tr>
        `;
    });

    table.innerHTML = html;
}

/* -------------------------
   MARQUER ABSENCE
--------------------------*/
function toggleAbsence(key, id) {
    let abs = classe.absences[key];
    if (abs.includes(id)) abs.splice(abs.indexOf(id), 1);
    else abs.push(id);
    save();
}

/* -------------------------
   TOUT COCHER
--------------------------*/
function markAll() {
    let date = dateSel.value;
    let h1 = heureDebut.value;
    let h2 = heureFin.value;
    let mat = matiere.value;

    if (!date || !h1 || !h2) return alert("Choisis la date + heures.");

    let key = `${date}_${h1}-${h2}_${mat}`;
    classe.absences[key] = classe.students.map((s, i) => i+1);

    renderTable(key);
    save();
}

/* -------------------------
   SUPPRIMER √âL√àVE
--------------------------*/
function deleteStudent(i) {
    if (!confirm("Supprimer cet √©l√®ve ?")) return;

    classe.students.splice(i, 1);

    for (let k in classe.absences) {
        classe.absences[k] = classe.absences[k].filter(id => id !== i+1);
    }

    save();
    loadAttendance();
}

/* -------------------------
   R√âSUM√â
--------------------------*/
function afficherResume() {
    let zone = document.getElementById("resume");
    zone.innerHTML = "";

    if (Object.keys(classe.absences).length === 0) {
        zone.innerHTML = "<p>Aucune absence enregistr√©e.</p>";
        return;
    }

    let dates = {};

    for (let key in classe.absences) {
        let parts = key.split("_");
        let date = parts[0];
        let hours = parts[1];
        let mat = parts[2];

        if (!dates[date]) dates[date] = [];
        dates[date].push({ hours, mat, eleves: classe.absences[key] });
    }

    for (let d in dates) {
        let block = document.createElement("div");
        block.className = "block";

        block.innerHTML += `<div class='date-title'>üìÖ ${d}</div>`;

        dates[d].forEach(info => {
            let list = info.eleves.map(id => classe.students[id - 1]).join(", ");

            block.innerHTML += `
                <div class="hour-title">‚è∞ ${info.hours}</div>
                <div class="matiere">üìò ${info.mat}</div>
                <div class="student-list">${list || "<i>Aucun</i>"}</div>
                <hr>
            `;
        });

        zone.appendChild(block);
    }
}
</script>

</body>
</html>